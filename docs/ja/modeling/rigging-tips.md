# リギングのコツ

Live2Dモデルのリギング（セットアップ）に関するベストプラクティス集です。

## 目次

1. [基本的な考え方](#基本的な考え方)
2. [パーツ分けのコツ](#パーツ分けのコツ)
3. [メッシュ設定](#メッシュ設定)
4. [デフォーマ設定](#デフォーマ設定)
5. [パラメータ設計](#パラメータ設計)
6. [よくある失敗と対策](#よくある失敗と対策)

---

## 基本的な考え方

### リギングの目的

1. **自然な動き**: 人間らしい、違和感のない動作
2. **表現力**: 感情や意図を伝えられる
3. **パフォーマンス**: 軽快な動作

### 作業の流れ

```
1. パーツ確認・整理
   ↓
2. メッシュ作成
   ↓
3. デフォーマ設定
   ↓
4. パラメータ作成
   ↓
5. 動作確認・調整
   ↓
6. 物理演算設定
```

---

## パーツ分けのコツ

### 基本ルール

**ルール1: 動かしたい部分は分ける**
```
✓ 良い例: まぶた、瞳、白目を別パーツに
✗ 悪い例: 目全体を1パーツに
```

**ルール2: 隠れる部分も描く**
```
✓ 前髪の下の額を描いておく
✓ 閉じた目の下まぶた部分
✓ 口を開けた時の口内
```

**ルール3: 重なり順を意識**
```
奥 → 手前 の順で:
後ろ髪 → 体 → 首 → 顔 → 目 → 前髪
```

### パーツ命名規則

```
推奨フォーマット: カテゴリ_部位_左右_詳細

例:
face_eye_L_pupil    (顔_目_左_瞳)
face_eye_L_white    (顔_目_左_白目)
face_mouth_upper    (顔_口_上唇)
hair_front_01       (髪_前髪_01)
```

---

## メッシュ設定

### メッシュの基本

メッシュ = パーツを変形させるための網目構造

### 密度の目安

| パーツ | 密度 | 理由 |
|--------|------|------|
| 顔輪郭 | 高 | 複雑な変形が必要 |
| 目 | 高 | 開閉、視線移動 |
| 口 | 高 | 様々な形状変化 |
| 髪 | 中 | なびき表現 |
| 体 | 低 | 大きな変形は少ない |
| 服 | 中〜低 | デザインによる |

### 自動生成 vs 手動

**自動生成が適するケース:**
- 単純な形状のパーツ
- 大きな変形が不要

**手動調整が必要なケース:**
- 複雑な変形が必要（目、口など）
- エッジ（輪郭）の精度が重要

### メッシュ作成のコツ

1. **輪郭に沿って配置**
   - パーツの端にポイントを配置
   - 角は特に丁寧に

2. **変形する方向に沿って配置**
   - 縦に伸びるなら縦方向に整列
   - 回転するなら放射状に

3. **細かすぎない**
   - 必要以上に細かいとパフォーマンス低下
   - 変形が不自然になることも

---

## デフォーマ設定

### デフォーマの種類

| 種類 | 用途 | 例 |
|------|------|-----|
| 回転デフォーマ | 回転運動 | 首回転、腕の振り |
| ワープデフォーマ | 自由変形 | 顔の傾き、表情 |

### 階層構造の設計

```
体（ワープ）
├── 首（回転）
│   └── 顔（ワープ）
│       ├── 顔輪郭（ワープ）
│       ├── 左目（ワープ）
│       │   ├── まぶた
│       │   ├── 白目
│       │   └── 瞳
│       ├── 右目（同様）
│       ├── 口（ワープ）
│       └── 眉（ワープ）
├── 左腕（回転）
└── 右腕（回転）
```

### ワープデフォーマのコツ

1. **分割数の目安**
   - 顔全体: 5×5 〜 7×7
   - 目・口: 3×3 〜 5×5
   - 髪: 3×5 〜 5×7（縦長が多い）

2. **大きさの目安**
   - パーツより少し大きめに
   - 変形範囲を考慮

### 回転デフォーマのコツ

1. **基準点の位置**
   - 自然な回転の中心に配置
   - 首: 首の付け根
   - 腕: 肩の関節位置

2. **回転範囲**
   - 実際の可動範囲を意識
   - 首: ±30度程度

---

## パラメータ設計

### 標準パラメータ

VTube Studioで使用される主要パラメータ:

| パラメータ名 | 範囲 | 用途 |
|-------------|------|------|
| ParamAngleX | -30〜30 | 顔の左右 |
| ParamAngleY | -30〜30 | 顔の上下 |
| ParamAngleZ | -30〜30 | 顔の傾き |
| ParamEyeLOpen | 0〜1 | 左目開閉 |
| ParamEyeROpen | 0〜1 | 右目開閉 |
| ParamEyeBallX | -1〜1 | 視線左右 |
| ParamEyeBallY | -1〜1 | 視線上下 |
| ParamMouthOpenY | 0〜1 | 口開閉 |
| ParamMouthForm | -1〜1 | 口の形 |
| ParamBrowLY | -1〜1 | 左眉上下 |
| ParamBrowRY | -1〜1 | 右眉上下 |

### AITuber用カスタムパラメータ

本プロジェクトで使用:

| パラメータ名 | 範囲 | 用途 |
|-------------|------|------|
| AITuberMouthOpen | 0〜1 | リップシンク |

### パラメータ設定のコツ

1. **キーフォームは最低3つ**
   - 最小値、中央値、最大値
   - 必要に応じて中間も

2. **動きの緩急をつける**
   - 最初と最後はゆっくり
   - 中間は素早く

3. **複合動作の考慮**
   - 目を閉じながら笑う
   - 口を開けながら驚く

---

## よくある失敗と対策

### 失敗1: 目が破綻する

**症状:** 瞬きや視線移動で目が崩れる

**原因:**
- メッシュが粗い
- デフォーマの設定ミス

**対策:**
- まぶた、白目、瞳のメッシュを細かく
- 目の開閉パラメータを丁寧に調整

### 失敗2: 口が不自然

**症状:** リップシンクで口が変な形になる

**原因:**
- 口のパーツ分けが不十分
- パラメータの範囲が適切でない

**対策:**
- 上唇、下唇、口内、歯を分ける
- 複数の口の形を作成

### 失敗3: 髪が体を突き抜ける

**症状:** 顔を傾けると髪が体にめり込む

**原因:**
- デフォーマの階層構造ミス
- クリッピング設定忘れ

**対策:**
- 髪を顔と同じ親デフォーマに
- 必要に応じてクリッピング

### 失敗4: 動きがカクカク

**症状:** アニメーションが滑らかでない

**原因:**
- キーフォームが少ない
- 補間設定が不適切

**対策:**
- キーフォームを追加
- ベジェ曲線で補間

### 失敗5: パフォーマンス低下

**症状:** 動作が重い

**原因:**
- メッシュが細かすぎる
- デフォーマが多すぎる
- テクスチャが大きすぎる

**対策:**
- 不要な部分のメッシュを粗く
- デフォーマを統合
- テクスチャを最適化（2K推奨）

---

## チェックリスト

### リギング完了前の確認

- [ ] すべてのパーツにメッシュが設定されている
- [ ] デフォーマの階層構造が適切
- [ ] 標準パラメータがすべて動作する
- [ ] 顔の向きを変えても破綻しない
- [ ] 目の開閉が自然
- [ ] 口の開閉でリップシンクができる
- [ ] 物理演算（髪揺れ等）が設定されている
- [ ] VTube Studioで正しく動作する

---

## 参考資料

- [Live2D公式マニュアル](https://docs.live2d.com/)
- [Live2D公式チュートリアル](https://docs.live2d.com/cubism-editor-tutorials/)
- [VTube Studio Wiki](https://github.com/DenchiSoft/VTubeStudio/wiki)
