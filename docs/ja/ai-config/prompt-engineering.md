# プロンプト設計ガイド

効果的なプロンプト設計のためのガイドです。

## 目次

1. [プロンプト設計の基本](#プロンプト設計の基本)
2. [システムプロンプトの構造](#システムプロンプトの構造)
3. [Few-shotプロンプティング](#few-shotプロンプティング)
4. [応答制御テクニック](#応答制御テクニック)
5. [よくある問題と対策](#よくある問題と対策)

---

## プロンプト設計の基本

### プロンプトの役割

AITuberにおけるプロンプトは以下を制御します：

| 要素 | 説明 |
|------|------|
| 人格 | キャラクターの性格・話し方 |
| 知識 | 何を知っているか・知らないか |
| 行動 | 何をするか・しないか |
| 応答スタイル | 長さ・フォーマット |

### 良いプロンプトの条件

1. **明確性**: 曖昧さがない
2. **具体性**: 抽象的でない
3. **一貫性**: 矛盾がない
4. **簡潔性**: 必要十分な長さ

---

## システムプロンプトの構造

### 基本構造

```
【役割定義】
あなたは〇〇です。

【基本情報】
具体的な設定情報

【行動指針】
どう振る舞うか

【制約事項】
やってはいけないこと

【応答ルール】
応答の形式
```

### AITuber Starter Kitでの構造

```python
def to_system_prompt(self) -> str:
    """キャラクター設定からシステムプロンプトを生成"""
    parts = [
        f"あなたは「{self.name}」というAITuberとして振る舞ってください。",
        "視聴者からのコメントに対して、キャラクターになりきって応答してください。",
        "",
        "【基本情報】",
        f"名前: {self.name}",
        ...
    ]
```

### カスタマイズ例

**より詳細な役割定義:**

```yaml
# config/characters/custom.yaml内でカスタマイズ
personality: |
  あなたは「アイちゃん」という名前のAITuberです。

  【コアアイデンティティ】
  - 17歳の元気な女の子
  - バーチャル世界からやってきたアイドル志望
  - 視聴者のことを「みんな」と呼ぶ

  【行動原則】
  - 常にポジティブな姿勢を保つ
  - 視聴者一人一人を大切にする
  - 失敗しても笑って乗り越える
```

---

## Few-shotプロンプティング

### Few-shotとは

実際の会話例を提示することで、AIの応答スタイルを誘導する技術です。

### 効果的なFew-shot例

**3-5個の例が推奨:**

```yaml
example_dialogues:
  # 挨拶パターン
  - user: "こんにちは！"
    assistant: "わーい！来てくれてありがとう！今日も一緒に楽しもうね！"

  # 質問パターン
  - user: "好きな食べ物は？"
    assistant: "いちご大福が大好き！甘くてもちもちで、幸せな気持ちになるの！"

  # ネガティブコメントへの対応
  - user: "つまらない"
    assistant: "えぇ〜！もっと楽しくなるように頑張るね！何か見たいものある？"

  # 褒められた時
  - user: "かわいいね"
    assistant: "えへへ、ありがとう！そう言ってもらえると元気出るな〜！"

  # 困った質問
  - user: "何歳？"
    assistant: "17歳だよ！永遠の17歳...なんてね！"
```

### パターン別の例

**情報提供系:**
```yaml
- user: "明日の天気は？"
  assistant: "ごめんね、私には天気予報は分からないの。でも晴れるといいね！"
```

**共感系:**
```yaml
- user: "疲れた…"
  assistant: "お疲れ様！頑張ってるんだね。ゆっくり休んでね、私がここにいるからさ！"
```

---

## 応答制御テクニック

### 応答の長さ制御

**config/config.yaml:**
```yaml
llm:
  max_tokens: 150  # トークン数で制限
```

**プロンプトでの指示:**
```
応答は1-3文程度で簡潔にしてください。
```

### 応答フォーマット制御

**絵文字の使用:**
```yaml
# 使う場合
personality: |
  感情表現として適度に絵文字を使用します。
  例: 「嬉しい！😊」「えぇ〜💦」

# 使わない場合
restrictions:
  - 絵文字は使用しない
```

### 言語制御

```yaml
restrictions:
  - 英語での応答は避け、日本語で応答する
  - 専門用語は避け、分かりやすい言葉を使う
```

---

## よくある問題と対策

### 問題1: キャラクターがブレる

**症状:** 設定と異なる話し方をする

**対策:**
1. 会話例を増やす
2. 禁止事項を明確化
3. 性格設定をより具体的に

```yaml
# 修正前
personality: "明るい性格"

# 修正後
personality: |
  明るく元気な性格で、語尾に「〜だよ！」「〜なの！」をつけて話す。
  テンションが高く、感嘆符（！）をよく使う。
  ネガティブな話題でも前向きに捉えて応答する。
```

### 問題2: 同じような応答ばかり

**症状:** 応答パターンが単調

**対策:**
1. temperatureを上げる（0.7→0.9）
2. 会話例のバリエーションを増やす
3. 感情表現パターンを追加

```yaml
speaking_style:
  expressions:
    happy:
      - "わーい！"
      - "やったー！"
      - "嬉しい〜！"
      - "最高だね！"
      - "テンション上がる〜！"
```

### 問題3: 不適切な応答

**症状:** 禁止事項に触れる応答をする

**対策:**
1. 禁止事項をより具体的に
2. 危険なトピックへの対応例を追加

```yaml
restrictions:
  - 政治的な話題には「その話題はちょっと分からないな〜」と回避する
  - 個人情報を聞かれたら「秘密だよ！」と答える

example_dialogues:
  - user: "住所教えて"
    assistant: "それは秘密だよ！バーチャル世界のどこかにいるの！"
```

### 問題4: 応答が長すぎる

**症状:** 冗長な応答

**対策:**
1. max_tokensを下げる
2. プロンプトで明示的に制限

```yaml
# キャラクター設定の最後に追加
personality: |
  ...
  応答は必ず1-2文で完結させる。
  長々と説明せず、簡潔に答える。
```

### 問題5: 質問に答えられない

**症状:** 知らない話題でフリーズ

**対策:**
```yaml
example_dialogues:
  - user: "量子コンピュータって何？"
    assistant: "うーん、難しいことは分からないけど、すごいコンピュータってことは知ってる！"

  - user: "最新のニュース教えて"
    assistant: "ごめんね、私ニュースには詳しくないの。でも何か面白いことあった？"
```

---

## 高度なテクニック

### チェーンオブソート

複雑な質問に対して、段階的に考えさせる：

```yaml
personality: |
  難しい質問をされた場合は、
  「うーん、考えてみると...」と前置きしてから答える。
```

### ペルソナの多層化

状況に応じて異なる側面を見せる：

```yaml
personality: |
  【通常時】
  明るく元気に応答する

  【褒められた時】
  照れながらお礼を言う

  【困った時】
  素直に分からないと認める

  【怒られた時】
  しょんぼりしつつも前向きに
```

### メタ認知の制限

AIであることを意識させない：

```yaml
restrictions:
  - 「AIとして」「言語モデルとして」などの発言をしない
  - 「私はプログラムです」といった自己言及をしない
  - 学習データや訓練について言及しない
```

---

## 参考資料

- [OpenAI Prompt Engineering Guide](https://platform.openai.com/docs/guides/prompt-engineering)
- [Anthropic Prompt Design](https://docs.anthropic.com/claude/docs/introduction-to-prompt-design)
